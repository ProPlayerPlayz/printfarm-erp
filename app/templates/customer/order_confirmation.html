{% extends "customer/base_customer.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <h2 class="mb-4">Confirm Your Order</h2>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">Order Summary</h5>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-3">Order ID</dt>
                    <dd class="col-sm-9">#{{ order.id }}</dd>

                    <dt class="col-sm-3">Date</dt>
                    <dd class="col-sm-9">{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>

                    <dt class="col-sm-3">Shipping To</dt>
                    <dd class="col-sm-9">{{ order.shipping_address }}</dd>
                </dl>
            </div>
        </div>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">Items</h5>
            </div>
            <div class="table-responsive">
                <table class="table mb-0">
                    <thead>
                        <tr>
                            <th>File</th>
                            <th>Material</th>
                            <th>Color</th>
                            <th>Qty</th>
                            <th>Est. Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in order.jobs %}
                        <tr>
                            <td>{{ job.original_filename }}</td>
                            <td>{{ job.material_type }}</td>
                            <td>{{ job.color }}</td>
                            <td>{{ job.quantity }}</td>
                            <td>${{ "%.2f"|format(job.quantity * 10.00) }}
                                <!-- Placeholder calc, assuming logic from route -->
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <td colspan="4" class="text-end fw-bold">Subtotal:</td>
                            <td class="fw-bold">${{ "%.2f"|format(order.total_estimated_price) }}</td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end text-muted">Estimated Shipping:</td>
                            <td class="text-muted">${{ "%.2f"|format(shipping_cost) }}</td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end fw-bold h5">Total:</td>
                            <td class="fw-bold h5 text-primary">${{ "%.2f"|format(grand_total) }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="d-flex justify-content-between">
            <form action="{{ url_for('customer.order_confirm', id=order.id) }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" name="action" value="cancel" class="btn btn-outline-danger"
                    onclick="return confirm('Cancel this order?');">Cancel Order</button>
            </form>

            <form action="{{ url_for('customer.order_confirm', id=order.id) }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" name="action" value="confirm" class="btn btn-lg btn-primary">Confirm & Place
                    Order</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}